function randomNum(){return Math.floor(9e4*Math.random())+1e4}function randomRange(t,e){return Math.random()*(e-t)+t}function getRandomColor(){return colorPalette[Math.floor(Math.random()*colorPalette.length)]}function setUnitCounter(t){let e=parseInt(t);Number.isNaN(e)||t.toString().includes("-")||$("#unitCounter").text(e)}function incrementUnitCounter(t){let e=parseInt($("#unitCounter").text()),n=parseInt(t);Number.isNaN(n)||t.toString().includes("-")||$("#unitCounter").text(e+n)}function decrementUnitCounter(t){let e=parseInt($("#unitCounter").text()),n=parseInt(t);!Number.isNaN(n)&&e-n>=0&&!t.toString().includes("-")&&$("#unitCounter").text(e-n)}function saveSchedule(t){var e=$("#cal").fullCalendar("clientEvents"),n=[],r=[];if(0!=e.length)if(null==t||t.length<5)toastr.warning("Must be at least 5 characters.","Schedule Name Too Short");else{for(var a in e)if(!(r.indexOf(e[a].groupId)>=0))if(e[a].eventType===COURSE_2_EVENT_TYPE){var o={color:e[a].color,eventType:COURSE_2_EVENT_TYPE,course:e[a].course};n.push(o),r.push(e[a].groupId)}else{if(e[a].eventType!==CUSTOM_EVENT_TYPE)return void toastr.error("Please re-add your courses","Unsupported Courses");o={title:e[a].title,start:e[a].start.format("HH:mm"),end:e[a].end.format("HH:mm"),color:e[a].color,dow:e[a].daysOfTheWeek,eventType:CUSTOM_EVENT_TYPE};n.push(o),r.push(e[a].groupId)}$.ajax({url:"/schedules/add",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({username:t,data:n}),success:function(e){e.success&&(toastr.success(t,"Schedule Saved!"),localStorage.setItem("username",t),addToRecentSchedules(t))},error:function(e){toastr.error(t,"Schedule Not Saved")}})}else toastr.warning("Must add at least one course.","Empty Schedule")}function loadSchedule(t){null!=t&&""!=t?$.ajax({url:"/schedule/load",data:{username:t},success:function(e){if(e.success){let n=null;n="string"==typeof e.data?JSON.parse(e.data):e.data,$("#cal").fullCalendar("removeEvents"),$("#finals").fullCalendar("removeEvents");let r=$("#listing-datatable").DataTable();r.rows().deselect(),setUnitCounter(0);for(let t=0;t<n.length;t++)if(n[t].eventType===COURSE_2_EVENT_TYPE){for(let e in n[t].course.mtng){r.row(`#${n[t].course.code}`).select();let a=n[t].course.mtng[e];n[t].groupId=n[t].course.code,n[t].title=renderName(n[t].course.c_type,n[t].course.dept,n[t].course.num),n[t].start=a.start,n[t].end=a.end,n[t].dow=a.days,n[t].daysOfTheWeek=a.days}incrementUnitCounter(n[t].course.unit)}else n[t].eventType===CUSTOM_EVENT_TYPE&&(n[t].groupId=randomNum(),n[t].daysOfTheWeek=n[t].dow);$("#cal").fullCalendar("renderEvents",n),toastr.success(t,"Schedule Loaded!"),localStorage.setItem("username",t),addToRecentSchedules(t),switchToMainCalendar(),switchToMobileMainCalendar()}},error:function(e){toastr.error(t,"Schedule Not Found")}}):toastr.error(t,"Schedule Not Found")}function switchToMainCalendar(){$("#finals-btn").hasClass("active")&&($("#finals").hide(),$("#cal").show(),$("#finals-btn").removeClass("active"),$("#cal").fullCalendar("rerenderEvents"))}function switchToMobileListing(){isMobile&&$("#search-btn").click()}function switchToMobileMainCalendar(){isMobile&&$("#calendar-btn").click()}function setupCourseInfoListeners(){$(".course-info").click(async function(){let t=this,e=encodeURIComponent(`${$(this).data("dept")} ${$(this).data("num")}`);sessionStorage.getItem("courseInfo")||sessionStorage.setItem("courseInfo",JSON.stringify({}));let n=JSON.parse(sessionStorage.getItem("courseInfo"));e in n?(await sleep(1),$(t).popover({html:!0,content:n[e],trigger:"manual",placement:"right",container:".dataTables_scrollBody"}),$(t).popover("toggle")):$.get(`/catalogue?q=${e}`).done(function(t){n[e]=t,sessionStorage.setItem("courseInfo",JSON.stringify(n))}).fail(function(){n[e]="Course information not found.",sessionStorage.setItem("courseInfo",JSON.stringify(n))}).always(function(){$(t).popover({html:!0,content:n[e],trigger:"manual",placement:"right",container:".dataTables_scrollBody"}),$(t).popover("toggle")})}),$(".course-info").on("shown.bs.popover",function(){$(".bubblelink").attr("href",`http://catalogue.uci.edu${$(".bubblelink").attr("href")}`),$(".bubblelink").attr("target","_blank")})}function handleListing(t,e){$(".dataTables_scrollHead").css("visibility","visible");let n=$("#listing-datatable").DataTable();if(t.data.length&&!isMobile&&!isiPad){let e="wtlt:name",r="nor:name",a=n.column(e).visible(),o=n.column(r).visible(),i=!1;t.data[0].courses[0].sections[0].wtlt&&!a&&n.column(e).visible(!0,!1),i=!0,!t.data[0].courses[0].sections[0].wtlt&&a&&n.column(e).visible(!1,!1),t.data[0].courses[0].sections[0].nor&&!o&&n.column(r).visible(!0,!1),i=!0,!t.data[0].courses[0].sections[0].nor&&o&&n.column(r).visible(!1,!1),i&&n.draw(!1)}for(let t in e)n.row(`#${e[t]}`).select();$("div.code-cell").click(function(t){t.stopPropagation();var e=document.createElement("input");e.setAttribute("value",$(this).text()),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),toastr.success("Copied Course Code")}),(isMobile||isiPad)&&$("#listing-datatable").css("table-layout","fixed")}function setupListing(){$("#listing-datatable").DataTable().order([0,"asc"]),$(".dataTables_scrollHead").css("visibility","hidden"),$("#search").hide(),$("#soc").show(),(isMobile||isiPad)&&($(".btn-colvis").click(function(){$(".dt-button-collection").css("overflow","auto"),$(".dt-button-collection").css("height","400px")}),$(".dataTables_filter input").css("width","125px"))}function daysOfTheWeekToStr(t){var e=[];for(var n in t)e.push(WEEKDAY_TO_STRING[t[n]]);return e}function sleep(t){return new Promise(e=>setTimeout(e,t))}function addToRecentSchedules(t){var e=JSON.parse(localStorage.getItem("recentSchedules"));indexOfScheduleName=e.indexOf(t),-1===indexOfScheduleName?(e.unshift(t),e.length>5&&e.pop()):(e.splice(indexOfScheduleName,1),e.unshift(t)),localStorage.setItem("recentSchedules",JSON.stringify(e))}function arrToTable(t){var e='<tr><td style="color:rgb(206, 212, 218)">Empty</tr></td>';return"[]"!==t&&(e=t.replace(/",/g,"</a></td></tr><tr><td><a class='recentSchedule' href='#'>").replace('["',"<tr><td><a class='recentSchedule' href='#'>").replace('"]',"</a></td></tr>").replace(/"/g,"")),`<table class="w-100">\n\t\t\t\t<tr style="border-bottom:solid 1px"><th>Recent Schedules</th><th><a id="clearRecents" href="#">Clear All<a></th></tr>\n\t\t\t\t${e}\n\t\t\t</table>`}function toggleOptions(){var t=document.getElementById("moreOptions"),e=document.getElementById("moreOptionsButton");"none"===t.style.display?(t.style.display="block",e.innerText="Show Less Options"):(t.style.display="none",e.innerText="Show More Options")}function renderInstructor(t,e=!0){var n="";for(var r in t)"STAFF"!==t[r]&&e?n+=`<div><a href="javascript:void(0)">${t[r]}</a></div>`:n+=`<div>${t[r]}</div>`;return n}function renderLocation(t,e=!1){var n="",r="";for(var a in t)t[a].rm?(t[a].rm_l?n+=`<div><a href="${t[a].rm_l}" target="_blank">${t[a].bldg} ${t[a].rm}</a></div>`:n+=`<div>${t[a].bldg} ${t[a].rm}</div>`,r+=`${t[a].bldg} ${t[a].rm} `):(n+=`<div>${t[a].bldg}</div>`,r+=`${t[a].bldg} `);return e?r:n}function renderName(t,e,n){return`${t} ${e} ${n}`}function setupColorPicker(t,e,n){t.on("inserted.bs.popover",function(){$(`#colorpicker-${n}`).spectrum({color:e.color,showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"more colors",togglePaletteLessText:"less colors",hideAfterPaletteSelect:!0,preferredFormat:"hex",showInput:!0,palette:[colorPalette],change:function(t){if($(`#colorpicker-${n}`).spectrum("destroy"),$(`#colorpicker-${n}`).hide(),$("#cal").fullCalendar("removeEvents",e._id),e.eventType==COURSE_2_EVENT_TYPE)for(var r in e.course.mtng)e.start=e.course.mtng[r].start,e.end=e.course.mtng[r].end,e.dow=e.course.mtng[r].days,e.color=t.toHexString(),$("#cal").fullCalendar("renderEvent",e);else e.start=e.start.format("HH:mm"),e.end=e.end.format("HH:mm"),e.dow=e.daysOfTheWeek,e.color=t.toHexString(),$("#cal").fullCalendar("renderEvent",e)}})}),t.on("hide.bs.popover",function(){$(`#colorpicker-${n}`).spectrum("destroy"),$(`#colorpicker-${n}`).hide()})}function renderCoursePopover(t,e,n=!1){let r="",a="",o=randomNum();e.eventType==COURSE_2_EVENT_TYPE?(r=e.course.title,a=`<table>\n\t\t\t\t\t\t\t<tr class="border-bottom">\n\t\t\t\t\t\t\t\t<td class="pr-2 pb-1">Name</td>\n\t\t\t\t\t\t\t\t<td align="right">${renderName(e.course.c_type,e.course.dept,e.course.num)}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr class="border-bottom">\n\t\t\t\t\t\t\t\t<td class="pr-2 pb-1">Code</td>\n\t\t\t\t\t\t\t\t<td align="right">${e.course.code}</td>\n\t\t\t\t\t\t\t</tr>`,n?a+=`<tr class="border-bottom">\n\t\t\t\t\t\t\t\t\t<td class="pr-2 pb-1">Time</td>\n\t\t\t\t\t\t\t\t\t<td align="right">${e.course.final.f_time}</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="pr-2 pb-1">Instructor</td>\n\t\t\t\t\t\t\t\t\t<td align="right">${renderInstructor(e.course.instr,!1)}</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>`:(setupColorPicker(t,e,o),a+=`<tr class="border-bottom">\n\t\t\t\t\t\t\t\t<td class="pr-2 pb-1">Location</td>\n\t\t\t\t\t\t\t\t<td align="right">${renderLocation(e.course.mtng)}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr class="border-bottom">\n\t\t\t\t\t\t\t\t<td class="pr-2 pb-1">Instructor</td>\n\t\t\t\t\t\t\t\t<td align="right">${renderInstructor(e.course.instr,!1)}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td class="pr-2 pb-1">Color</td>\n\t\t\t\t\t\t\t\t<td align="right"><input id="colorpicker-${o}" type="text"/></td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td colspan="2"><button class="btn btn-sm btn-primary mt-1 w-100 delete-event">Remove <i class="fas fa-trash-alt"></i></button></td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>`)):e.eventType==CUSTOM_EVENT_TYPE&&(r=e.title,setupColorPicker(t,e,o),a=`<table>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td class="pr-1">Color</td>\n\t\t\t\t\t\t\t\t<td align="right"><input id="colorpicker-${o}" type="text"/></td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td colspan="2"><button class="btn btn-sm btn-primary w-100 delete-event">Remove <i class="fas fa-trash-alt"></i></button></td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>`),$(".popover").each(function(){$(this).popover("hide")}),t.popover({html:!0,title:r,content:a,trigger:"focus",placement:"right",container:"body"}),t.on("show.bs.popover",function(){$(".popover").each(function(){$(this).popover("hide")})})}function setPopoverTrigger(t){t.on("mouseenter",function(){var t=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(t).popover("hide")})}),t.on("mouseleave",function(){var t=this;$(".popover:hover").length||$(t).popover("hide")})}let catalogue_cache={},last_search_request_type=-1,fail_count=0;const FORM_REQUEST_TYPE=0,LIST_REQUEST_TYPE=1,WEEKDAY_TO_STRING={1:"MO",2:"TU",3:"WE",4:"TH",5:"FR"},COURSE_EVENT_TYPE=0,CUSTOM_EVENT_TYPE=1,ANTPLANNER_EVENT_TYPE=2,COURSE_2_EVENT_TYPE=3,isMobile=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid=/Android/i.test(navigator.userAgent),isiPad=navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2,restrictions={A:"Prerequisite required",B:"Authorization code required",C:"Fee required",D:"Pass/Not Pass option only",E:"Freshmen only",F:"Sophomores only",G:"Lower-division only",H:"Juniors only",I:"Seniors only",J:"Upper-division only",K:"Graduate only",L:"Major only",M:"Non-major only",N:"School major only",O:"Non-school major only",R:"Biomedical Pass/Fail course (School of Medicine only)",S:"Satisfactory/Unsatisfactory only",X:"Separate authorization codes required to add, drop, or change enrollment"},colorPalette=["#C4A883","#A7A77D","#85AAA5","#94A2BE","#8997A5","#A992A9","#A88383","#E6804D","#F2A640","#E0C240","#BFBF4D","#8CBF40","#4CB052","#65AD89","#59BFB3","#668CD9","#668CB3","#8C66D9","#B373B3","#E67399","#D96666"];$(document).ready(function(){const t=$("#year-term").val();$("#department-select").select2({theme:"bootstrap4",sorter:function(t){let e=$(".select2-search__field").val().toLowerCase();return t.sort(function(t,n){return t.text.replace(/[\W]/gi,"").toLowerCase().indexOf(e)-n.text.replace(/[\W]/gi,"").toLowerCase().indexOf(e)})},matcher:function(t,e){if(""===$.trim(t.term))return e;let n=e.text.toLowerCase().replace(/[\W]/gi,""),r=t.term.toLowerCase().replace(/[\W]/gi,""),a=e.text.toLowerCase().split(/[\W]/),o="";for(i=0;i<a.length;i++)a[i].length>0&&(o+=a[i][0]);return o.indexOf(r)>-1?e:n.indexOf(r)>-1?e:null}}),$("#reset-btn").click(function(){$("#department-select").val(" ALL").trigger("change")}),window.Split(["#left","#right"],{sizes:[45,55],gutterSize:10,minSize:20,elementStyle:function(t,e,n){return{width:`calc(${e}% - ${n}px)`}},onDragEnd:async function(t){isiPad?(await sleep(500),$("#listing-datatable").DataTable().draw(),$("#listing-datatable").css("table-layout","fixed")):$("#listing-datatable").DataTable().columns.adjust().draw()}}),$(".gutter").append('<i class="fas fa-ellipsis-v"></i>');var e=$("#listing-datatable").DataTable({paging:!1,scrollResize:!0,scrollY:100,scrollX:!0,scrollCollapse:!0,autoWidth:!1,rowId:"code",stateSave:!0,stateDuration:0,searchDelay:500,searching:!1,processing:!0,language:{search:"",searchPlaceholder:"Search...",processing:'<div id="loading" class="lds-ring"><div></div><div></div><div></div><div></div></div>',zeroRecords:"No courses matched your search criteria for this term."},select:{style:"multi"},preDrawCallback:function(t){(isMobile||isiPad)&&$("#listing-datatable").css("table-layout","auto")},dom:"Bftr",buttons:[{text:'<i class="fas fa-chevron-left"></i> Back',action:function(t,e,n,r){$("#soc").hide(),$("#search").show(),e.search("")},className:"btn btn-secondary"},{extend:"colvis",className:"btn btn-link btn-colvis",text:"Hide columns"}],rowGroup:{dataSrc:["dept_n","num","title"],startClassName:"row-group",startRender:function(t,e,n){if(0==n)return e;if(1!=n){let e=t.data()[0],n=`${e.dept} ${e.num} ${e.title} <i class="fas fa-info-circle course-info cursor-pointer" data-dept="${e.dept}" data-num="${e.num}"></i>`,r="";return e.comm&&(r=`<div class="m-1 p-1 comment">${e.comm}</div>`),e.prereq&&(r=`<a href="${e.prereq}" class="ml-3" target="_blank">(Prereqs)</a>${r}`),n+r}},endRender:function(t,e,n){if(2==n)return" "}},ajax:{url:"/search",dataSrc:function(t){let e=[];for(let n in t.data){let r=t.data[n];for(let t in r.courses){let n=r.courses[t];for(let t in n.sections){let a=n.sections[t];e.push({dept_n:r.dept_n,num:n.num,dept:r.dept,title:n.title,prereq:n.prereq,comm:n.comm,code:a.code,c_type:a.c_type,s_num:a.s_num,unit:a.unit,m_enrll:a.m_enrll,enrll:a.enrll,wtlt:a.wtlt,wt_cp:a.wt_cp,nor:a.nor,stat:a.stat,rstrcn:a.rstrcn,mtng:a.mtng,final:a.final,instr:a.instr})}}}return e},cache:!0,beforeSend:function(){$("#listing-datatable > tbody").html("<tr></tr>")}},columns:[{title:"Code",name:"code",data:"code",render:function(t,e,n,r){return"display"===e?`<div class='code-cell'>${t}</div>`:t}},{title:"Type",name:"type",data:"c_type"},{title:"Sec",name:"sec",data:"s_num"},{title:"Units",name:"unit",data:"unit"},{title:"Instructor",name:"instr",data:"instr",defaultContent:"",render:function(t,e,n,r){return"display"===e?renderInstructor(t.map(t=>t.name)):t.map(t=>t.name).join(" ")},createdCell:function(t,e,n,r,a){let o=0;$(t).find("a").each(function(){let t="",n=e[o];"STAFF"===n.name&&(o+=1,n=e[o]);let r=n.name.split(",")[0];n.rating?t+=`<div><a href="https://www.ratemyprofessors.com/ShowRatings.jsp?tid=${n.rating.id}" target="_blank">View on RMP</a></div>`:t+=`<div><a href="https://www.ratemyprofessors.com/search.jsp?queryoption=HEADER&queryBy=teacherName&schoolName=University+of+California+Irvine&schoolID=1074&query=${r}" target="_blank">Search on RMP</a></div>`;let a=r.split(" ")[0].split("-")[0];t+=`<div><a href="https://eaterevals.eee.uci.edu/browse/instructor#${a}" target="_blank">Search on EaterEvals</a></div>`;let i=$(this).popover({html:!0,container:".dataTables_scrollBody",content:t,animation:!1,trigger:"manual"});setPopoverTrigger(i),o+=1})}},{title:"Rating",name:"rating",data:"instr",defaultContent:"",render:function(t,e,n,r){return"display"!==e?t[0]&&t[0].rating&&t[0].rating.avg?t[0].rating.avg:0:t[0]&&t[0].rating&&t[0].rating.avg?`<a data-id="${randomNum()}" href="javascript:void(0)">${t[0].rating.avg.toFixed(2)}</a>`:t[0]&&"STAFF"!==t[0].name?"N/A":void 0},createdCell:function(t,e,n,r,a){$(t).find("a").each(function(){let t=`<div class="container p-0">\n\t\t\t\t\t\t\t\t\t\t\t\t<h6>${e[0].name}</h6>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="row no-gutters">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-8">\n\t\t\t\t\t\t\t\t\t\t\t\t<div><a href="https://www.ratemyprofessors.com/ShowRatings.jsp?tid=${e[0].rating.id}" target="_blank">View on RMP</a></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>Average: ${e[0].rating.avg.toFixed(2)}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-4" style="height:3rem; width:3rem"><canvas id="${$(this).attr("data-id")}-chart"></canvas></div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>Number of Reviews: ${e[0].rating.cnt}</div>\n\t\t\t\t\t\t\t\t\t\t\t </div>`,n=$(this).popover({html:!0,container:".dataTables_scrollBody",content:t,trigger:"manual",sanitize:!1,animation:!1});setPopoverTrigger(n),n.on("inserted.bs.popover",function(){let t=[];if(e[0].rating){let n="rgba(254, 107, 100, 1)";e[0].rating.avg>=3&&(n="rgb(255,193,7,1)"),e[0].rating.avg>=4&&(n="rgb(40,167,68,1)"),t.push({label:"Instructor",backgroundColor:[n,"rgba(255, 255, 255, 1)"],data:[e[0].rating.avg.toFixed(2),5-e[0].rating.avg.toFixed(2)]})}let n={labels:[],datasets:t};new Chart(`${$(this).attr("data-id")}-chart`,{type:"doughnut",data:n,options:{legend:{display:!1},tooltips:{enabled:!1},maintainAspectRatio:!1}})})})}},{title:"GPA",name:"gpa",data:"instr",defaultContent:"",render:function(t,e,n,r){return"display"!==e?t[0]&&t[0].grade&&t[0].grade.gpa?t[0].grade.gpa:0:t[0]&&t[0].grade&&t[0].grade.gpa?`<a data-id="${randomNum()}" href="javascript:void(0)">${t[0].grade.gpa.toFixed(2)}</a>`:t[0]&&"STAFF"!==t[0].name?"N/A":void 0},createdCell:function(t,e,n,r,a){$(t).find("a").each(function(){let t=`<h6 class="center-text">Grade Distribution <i id="${$(this).attr("data-id")}-info" class="fas fa-question-circle"></i></h6>`,n="320px";e[0]&&e[0].grade&&e[0].grade.rec_g?(t+=`<div class="mb-1 center-text">(Last Taught: ${e[0].grade.rec_q}, ${e[0].grade.rec_y})</div>`,n="340px"):(t+='<div class="mb-1 center-text">(Instructor hasn\'t taught course recently)</div>',n="340px"),t+=`<canvas id="${$(this).attr("data-id")}-chart" width="400" height="400" ></canvas>`;let r=$(this).popover({container:".dataTables_scrollBody",html:!0,content:t,trigger:"click",sanitize:!1,animation:!1});setPopoverTrigger(r),r.on("show.bs.popover",function(){$($(this).data("bs.popover").getTipElement()).css("height",n),$($(this).data("bs.popover").getTipElement()).css("min-width","300px")}),r.on("inserted.bs.popover",function(){let t=$(`#${$(this).attr("data-id")}-info`).popover({container:".popover",html:!0,content:$("#chart-info").html(),trigger:"manual",animation:!1});setPopoverTrigger(t);var n=["A","B","C","D","F"],r=[];e[0]&&e[0].grade&&e[0].grade.instr_g&&(r.push({label:"Instructor",backgroundColor:"rgba(254, 107, 100, 1)",data:e[0].grade.instr_g}),e[0].grade.course_g&&(r.push({label:"Course",backgroundColor:"rgba(119, 158, 203, 1)",data:e[0].grade.course_g}),r.push({label:"Recent",backgroundColor:"rgba(119, 221, 119, 1)",data:e[0].grade.rec_g})));var a={labels:n,datasets:r};new Chart(`${$(this).attr("data-id")}-chart`,{type:"bar",data:a,options:{}})})})}},{title:"Time",name:"time",data:"mtng",render:function(t,e,n,r){if("display"===e){let e="";for(let n=0;n<t.length;n++)e+=`<div>${t[n].f_time}</div>`;return e}return t.map(t=>t.f_time).join(" ")}},{title:"Place",name:"place",data:"mtng",render:function(t,e,n,r){return renderLocation(t)}},{title:"Final",name:"final",data:"final",render:function(t,e,n,r){return t?t.f_time:t}},{title:"Enr",name:"enrll",data:"enrll",defaultContent:"...",render:function(t,e,n,r){return"display"===e&&t?`${t}/${n.m_enrll}`:"sort"===e&&t?t/n.m_enrll:t}},{title:"WL",name:"wtlt",data:"wtlt",defaultContent:"...",render:function(t,e,n,r){return"display"===e&&t&&"n/a"!=t?`${t}/${n.wt_cp}`:"sort"===e&&t&&"n/a"!=t?t/n.wt_cp:t}},{title:"Nor",name:"nor",data:"nor",defaultContent:"..."},{title:"Rstr",name:"rstrcn",data:"rstrcn",render:function(t,e,n,r){return"display"===e&&t?`<a href="javascript:void(0)">${t}</a>`:t},createdCell:function(t,e,n,r,a){$(t).find("a").each(function(){let t='<a href="https://www.reg.uci.edu/enrollment/restrict_codes.html" target="_blank">Course Restriction Codes</a>',e=$(this).text();for(let n=0;n<e.length;n++)restrictions[e[n]]&&(t+=`<div><b>${e[n]}</b>: ${restrictions[e[n]]}</div>`);let n=$(this).popover({html:!0,container:".dataTables_scrollBody",content:t,trigger:"manual",animation:!1});setPopoverTrigger(n)})}},{title:"Status",name:"stat",data:"stat",defaultContent:"...",render:function(t,e,n,r){if("OPEN"===t){if("display"===e)return`<div class="text-success font-weight-bold">${t}</div>`;if("sort"===e)return 0}else if("Waitl"===t){if("display"===e)return`<div class="text-danger">${t}</div>`;if("sort"===e)return 1}else if("NewOnly"===t){if("display"===e)return`<div class="text-primary font-weight-bold">${t}</div>`;if("sort"===e)return 2}else if("FULL"===t&&"sort"===e)return 3;return t}}]});$.fn.dataTable.ext.errMode="none",$("#listing-datatable").on("error.dt",function(t,e,n,r){if(7==n){if(fail_count>=2)return toastr.error("All requests blocked by UCI","Please try again later"),fail_count=0,$("#soc").hide(),void $("#search").show();fail_count+=1;let t=randomRange(2e3,5e3);toastr.warning("Request blocked by UCI","Retrying...",{timeOut:t}),last_search_request_type==FORM_REQUEST_TYPE?sleep(t).then(()=>{$("#search-form").submit()}):last_search_request_type==LIST_REQUEST_TYPE&&sleep(t).then(()=>{$("#list-btn").click()})}else console.error("An error has been reported by DataTables: ",r)}).DataTable(),$("#search-form").submit(function(t){t.preventDefault();let n={};if($.each($(this).serializeArray(),function(t,e){n[e.name]=e.value}),"ANY"===n.Breadth&&""===n.InstrName&&""===n.CourseCodes&&"ALL"===n.Dept.trim())return void toastr.error("Please specify a Department, General Ed, Course Code, or Instructor");setupListing();let r=$("#cal").fullCalendar("clientEvents").map(({groupId:t})=>t);last_search_request_type=FORM_REQUEST_TYPE,e.ajax.url(`/search?${$(this).serialize()}`).load(function(t){handleListing(t,r)}),"ANY"!==n.Breadth&&toastr.warning("Results don't include Dis, Lab, etc.","Check for any Co-Courses")}),$("#listing-datatable").on("column-visibility.dt",async function(t,n,r,a){(isMobile||isiPad)&&(await sleep(50),e.columns.adjust().draw(),$("#listing-datatable").css("table-layout","fixed"))}),$("#list-btn").click(function(){$(".popover").each(function(){$(this).popover("hide")});var n="",r=$("#cal").fullCalendar("clientEvents"),a=[];for(var o in r)r[o].eventType!=CUSTOM_EVENT_TYPE&&-1==a.indexOf(r[o].groupId)&&a.push(r[o].groupId);n=a.join(","),""==n?toastr.warning("Must have at least 1 course added.","Cannot List Courses"):(setupListing(),switchToMobileListing(),last_search_request_type=LIST_REQUEST_TYPE,e.ajax.url(`/search?YearTerm=${t}&CourseCodes=${n}`).load(function(t){handleListing(t,a)}))}),$("#clear-cal-btn").on("click",function(){$(".popover").each(function(){$(this).popover("hide")}),$("#cal").fullCalendar("removeEvents"),$("#finals").fullCalendar("removeEvents"),e.rows().deselect(),switchToMainCalendar(),setUnitCounter(0)}),e.on("click","a",function(t){t.stopPropagation()}),e.on("deselect",function(t,n,r,a){if("row"===r){var o=e.rows(a).data()[0];decrementUnitCounter(o.unit);var i=$("#cal").fullCalendar("clientEvents");for(var s in i)i[s].groupId===o.code&&$("#cal").fullCalendar("removeEvents",i[s]._id)}}),e.on("user-select",function(t,n,r,a,o){if("row"===r){switchToMainCalendar();let t=e.rows(a.index().row).data()[0],n={dept:t.dept,code:t.code,c_type:t.c_type,num:t.num,title:t.title,unit:t.unit,mtng:t.mtng,final:t.final,instr:t.instr.map(t=>t.name)},r=$("#cal").fullCalendar("clientEvents");for(let t in r)if(r[t].groupId===n.code)return;incrementUnitCounter(n.unit),"TBA"===n.mtng[0].f_time&&(toastr.success("Click the List button to view the course","Added TBA Course to List"),n.mtng[0].start="0:00",n.mtng[0].end="0:00",n.mtng[0].days=[1]);let o=getRandomColor();for(let t in n.mtng){let e=n.mtng[t];$("#cal").fullCalendar("renderEvent",{groupId:n.code,start:e.start,end:e.end,dow:e.days,daysOfTheWeek:e.days,color:o,title:renderName(n.c_type,n.dept,n.num),course:n,eventType:COURSE_2_EVENT_TYPE})}}}),e.on("draw",function(){setupCourseInfoListeners()}),$("#moreOptionsButton").on("click",function(){toggleOptions()}),$(".btn").on("show.bs.popover",function(){$(".popover").each(function(){$(this).popover("hide")})}),$("body").on("click",function(t){0!==$(t.target).parents(".fc-event-container").length||0!==$(t.target).parents(".popover").length||0!==$(t.target).parents(".btn").length||$(t.target).hasClass("btn")||$(t.target).is("a")||$(".popover").each(function(){$(this).popover("hide")})}),$("#save-btn").click(function(){localStorage.getItem("recentSchedules")||localStorage.setItem("recentSchedules",JSON.stringify([])),$("#save-btn").popover({trigger:"manual",html:!0,title:"Save Schedule",content:function(){return`<div class="text-danger mb-2">Anyone can modify your schedule if they use the same name. Keep your schedule name unique and secret!</div>\n                        <div class="input-group mb-2">\n                            <input id="save-input" value="${localStorage.getItem("username")?localStorage.getItem("username"):""}" type="text" class="form-control save-input" placeholder="Schedule Name">\n                            <div class="input-group-append">\n                                <button id="save-button" class="btn btn-primary" type="button">Submit</button>\n                            </div>\n                        </div>\n                        <div>${arrToTable(localStorage.getItem("recentSchedules"))}</div>`},placement:"bottom",container:"body",boundary:"window"}),$("#save-btn").popover("toggle")}),$("#save-btn").on("shown.bs.popover",function(){$("#save-input").focus(),$("#save-input").keypress(function(t){t||(t=window.event);var e=t.keyCode||t.which;"13"==e&&(saveSchedule($("#save-input").val()),$("#save-btn").popover("hide"))}),$(".recentSchedule").on("click",function(){$("#save-input").val($(this).text()),$("#save-input").focus()}),$("#clearRecents").click(function(){localStorage.removeItem("recentSchedules"),localStorage.removeItem("username"),$("#save-btn").popover("hide")}),$("#save-button").click(function(){saveSchedule($("#save-input").val()),$("#save-btn").popover("hide")})}),$("#load-btn").click(function(){localStorage.getItem("recentSchedules")||localStorage.setItem("recentSchedules",JSON.stringify([])),$("#load-btn").popover({trigger:"manual",html:!0,title:"Load Schedule",content:function(){return`<div class="input-group mb-2">\n\t\t\t\t\t\t\t\t<input id="load-input" value="${localStorage.getItem("username")?localStorage.getItem("username"):""}" type="text" class="form-control" placeholder="Schedule Name">\n\t\t\t\t\t\t\t\t<div class="input-group-append">\n\t\t\t\t\t\t\t\t\t<button id="load-button" class="btn btn-primary" type="button">Submit</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>${arrToTable(localStorage.getItem("recentSchedules"))}</div>`},placement:"bottom",container:"body",boundary:"window"}),$("#load-btn").popover("toggle")}),$("#load-btn").on("shown.bs.popover",function(){$("#load-input").focus(),$("#load-input").keypress(function(t){t||(t=window.event);var e=t.keyCode||t.which;"13"==e&&(loadSchedule($("#load-input").val()),$("#load-btn").popover("hide"))}),$(".recentSchedule").on("click",function(){$("#load-input").val($(this).text()),$("#load-input").focus()}),$("#clearRecents").click(function(){localStorage.removeItem("recentSchedules"),localStorage.removeItem("username"),$("#load-btn").popover("hide")}),$("#load-button").click(function(){loadSchedule($("#load-input").val()),$("#load-btn").popover("hide")})}),$("#print-btn").click(function(){if(-1!==navigator.userAgent.indexOf("Chrome")){switchToMainCalendar();var t=$("#left").outerWidth();$("#right").hide(),$("#left").outerWidth("100%"),$("#cal").css("width","100%"),$("th, td, tr").css("border","2px solid #bfbfbf"),$(".fc-minor").css("border-top","3px dotted #bfbfbf"),$(".fc-time-grid .fc-slats td").css("height","46"),$("#cal").fullCalendar("option","height",$("#left").outerHeight()-$("#upper").outerHeight()),$(".popover").each(function(){$(this).popover("hide")}),window.print(),$("th, td, tr").css("border",""),$("#left").outerWidth(t),$("#right").width($("#right").width()-15),$("#right").show()}else toastr.error("Printing is currently only supported in Chrome","Unsupported Browser")}),$("#search-btn").click(async function(){$(".popover").each(function(){$(this).popover("hide")}),$(this).addClass("active"),$("#calendar-btn").removeClass("active"),$("#finals").animate({width:0},200,"swing"),$("#cal").animate({width:0},200,"swing"),await sleep(200),$("#left").width("0px"),$("#right").show()}),$("#calendar-btn").click(function(){$(".popover").each(function(){$(this).popover("hide")}),$(this).addClass("active"),$("#search-btn").removeClass("active"),$("#right").hide(),$("#left").width($(window).width()),$("#cal").animate({width:$(window).width()},200,"swing"),$("#finals").animate({width:$(window).width()},200,"swing")}),$("#finals-btn").click(function(){if($(".popover").each(function(){$(this).popover("hide")}),switchToMobileMainCalendar(),$(this).hasClass("active"))$("#finals").hide(),$("#cal").show(),$(this).removeClass("active"),$("#cal").fullCalendar("rerenderEvents");else{$("#finals").show(),$("#cal").hide(),$(this).addClass("active"),$("#finals").fullCalendar("removeEvents");var t=$("#cal").fullCalendar("clientEvents"),e=[],n=!1;for(var r in t)t[r].eventType===COURSE_2_EVENT_TYPE&&(t[r].course.final&&"TBA"===t[r].course.final.f_time&&(n=!0),!t[r].course.final||e.indexOf(t[r].groupId)>=0||($("#finals").fullCalendar("renderEvent",{groupId:t[r].groupId,start:t[r].course.final.start,end:t[r].course.final.end,title:t[r].title.split(/\s(.+)/)[1],dow:[t[r].course.final.day],color:t[r].color,course:t[r].course,eventType:COURSE_2_EVENT_TYPE}),e.push(t[r].groupId)));n&&toastr.warning("Use the List buttton to remove and re-add the course.","Course has a TBA Final"),$("#finals").fullCalendar("rerenderEvents")}$(window).trigger("resize")}),$("#export-btn").popover({html:!0,title:"Export to iCal",content:$("#export-btn-content").html(),placement:"bottom",container:"body",boundary:"window"}),$("#export-btn").on("shown.bs.popover",function(){$("#export-button").click(function(){$(".popover").each(function(){$(this).popover("hide")});var e=$("#cal").fullCalendar("clientEvents"),n=parseInt(t.substring(0,4)),r=null;for(var a in e){let t=e[a];if(t.eventType===COURSE_2_EVENT_TYPE&&t.course.final&&"TBA"!==t.course.final.f_time){let e,a,i=t.course.final;[e,a]=i.start.split(":"),r=new Date(n,i.month,i.date,e,a);var o=(8-r.getDay())%7;[6,0,1].includes(r.getDay())&&(o+=7),r.setDate(r.getDate()+o),r.setDate(r.getDate()-77);break}}if(null===r)return void toastr.error("Must add at least 1 course with a final in order to generate calendar export.","Cannot Export Courses");let i=[],s=ics(Date.now());for(a in e){let t=e[a];if(t.eventType!==COURSE_2_EVENT_TYPE&&t.eventType!==CUSTOM_EVENT_TYPE&&toastr.error("Please re-add your courses","Unsupported Courses"),0!=t.start.hours()&&-1==i.indexOf([t.groupId,t.daysOfTheWeek].toString())){let e=new Date(r);e.setDate(e.getDate()+(t.daysOfTheWeek[0]-1));let a=new Date(e);e.setHours(t.start.hours()),
e.setMinutes(t.start.minutes()),a.setHours(t.end.hours()),a.setMinutes(t.end.minutes());let o={freq:"WEEKLY",count:10*t.daysOfTheWeek.length,byday:daysOfTheWeekToStr(t.daysOfTheWeek)};if(t.eventType==CUSTOM_EVENT_TYPE)s.addEvent(t.title,"","",e,a,o);else{let n=renderLocation(t.course.mtng,asString=!0);s.addEvent(t.title,`Course Title: ${t.course.dept} ${t.course.num} ${t.course.title}\\nInstructor: ${t.course.instr.join(" ")}\\nCode: ${t.groupId}`,n,e,a,o)}if(t.eventType===COURSE_2_EVENT_TYPE&&t.course.final&&"TBA"!==t.course.final.f_time){let e,r,a=t.course.final;[e,r]=a.start.split(":");let o=new Date(n,a.month,a.date,e,r);[e,r]=a.end.split(":");let i=new Date(n,a.month,a.date,e,r);s.addEvent(`Final ${t.title.split(/\s(.+)/)[1]}`,`Course Title: ${t.course.dept} ${t.course.num} ${t.course.title}\\nInstructor: ${t.course.instr.join(" ")}\\nCode: ${t.groupId}`,"Check portal.uci.edu",o,i)}i.push([t.groupId,t.daysOfTheWeek].toString())}}s.download()})}),$("#event-btn").popover({html:!0,title:"Add a Custom Event",content:$("#event-btn-content").html(),placement:"bottom",container:"body",boundary:"window"}),$("#event-btn").on("shown.bs.popover",function(){$("#event-button").click(function(){var t=$("input[name=weekday-check]:checked");weekDays=[];for(var e=0;e<t.length;e++)weekDays.push(parseInt($(t[e]).attr("data")));$("#event-name").val().length<=0||$("#event-name").val().length>25?toastr.warning("Name must be between 1 and 25 characters.","Event Name"):$("#event-start").val()>=$("#event-end").val()?toastr.warning("Start time must come before end time.","Event Time"):0==weekDays.length?toastr.warning("Must have at least 1 weekday selected.","Event Weekday"):($("#cal").fullCalendar("renderEvent",{groupId:randomNum(),start:$("#event-start").val(),end:$("#event-end").val(),title:$("#event-name").val(),dow:weekDays,color:getRandomColor(),daysOfTheWeek:weekDays,eventType:CUSTOM_EVENT_TYPE}),switchToMainCalendar())})}),isMobile&&($("#mobile-btns").removeClass("d-none"),$("#right").hide(),$(".gutter").hide(),$("#print-btn").hide(),$("#export-btn").hide(),$("#clear-cal-btn").hide(),$("#event-btn").hide()),isiPad&&($("#print-btn").hide(),$("#export-btn").hide()),$(window).resize(function(){$("#left").height(`calc(100% - ${$("#upper").outerHeight()}px)`),$("#right").height(`calc(100% - ${$("#upper").outerHeight()}px)`),$("#search").outerHeight(`${$("#right").height()}px`),$(".gutter").height(`${$("#left").height()}px`),$(".fc-time-grid .fc-slats td").css({height:($("body").outerHeight()-$("#upper").outerHeight())/31}),$("#cal").fullCalendar("option","height",$("#left").outerHeight()),$("#finals").fullCalendar("option","height",$("#left").outerHeight()),isMobile&&($("#calendar-btn").hasClass("active")&&($("#left").width($(window).width()),$("#cal").width($(window).width()),$("#finals").width($(window).width())),$("#right").width($(window).width())),isiPad||isAndroid||$(".popover").each(function(){$(this).popover("hide")})}),$("#cal").fullCalendar({weekends:!1,header:!1,themeSystem:"bootstrap4",defaultView:"agendaWeek",allDaySlot:!1,slotEventOverlap:!1,minTime:"07:00:00",maxTime:"22:00:00",columnHeaderFormat:"ddd",eventRender:function(t,e){renderCoursePopover(e,t)},eventClick:function(t){let n=$(this);n.popover("toggle"),$(".delete-event").click(function(){n.popover("dispose"),$("#cal").fullCalendar("removeEvents",t._id);let r=e.row(`#${t.groupId}`);r.data()?r.deselect():t.course.unit&&decrementUnitCounter(t.course.unit)})}}),$("#finals").fullCalendar({header:!1,firstDay:6,themeSystem:"bootstrap4",defaultView:"agendaWeek",allDaySlot:!1,slotEventOverlap:!1,minTime:"07:00:00",maxTime:"22:00:00",columnHeaderFormat:"ddd",eventRender:function(t,e){renderCoursePopover(e,t,!0)},eventClick:function(){$(this).popover("toggle")}}),$(window).trigger("resize")});